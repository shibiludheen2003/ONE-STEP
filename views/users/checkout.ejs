<!doctype html>
<html class="no-js" lang="zxx">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Shibiludheen | eCommers</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
  <link rel="stylesheet" href="assets/css/slicknav.css">
  <link rel="stylesheet" href="assets/css/flaticon.css">
  <link rel="stylesheet" href="assets/css/animate.min.css">
  <link rel="stylesheet" href="assets/css/price_rangs.css">
  <link rel="stylesheet" href="assets/css/magnific-popup.css">
  <link rel="stylesheet" href="assets/css/fontawesome-all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <link rel="stylesheet" href="assets/css/themify-icons.css">
  <link rel="stylesheet" href="assets/css/slick.css">
  <link rel="stylesheet" href="assets/css/nice-select.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    .resp {
      display: flex;
      justify-content: space-between;
    }

    @media screen and (max-width : 768px) {
      .resp {
        display: block;
      }
    }
  </style>
  <script
    nonce="5bd111c4-bdf0-4e2f-b8c6-bdd849babf96">(function (w, d) { !function (f, g, h, i) { f[h] = f[h] || {}; f[h].executed = []; f.zaraz = { deferred: [], listeners: [] }; f.zaraz.q = []; f.zaraz._f = function (j) { return function () { var k = Array.prototype.slice.call(arguments); f.zaraz.q.push({ m: j, a: k }) } }; for (const l of ["track", "set", "debug"]) f.zaraz[l] = f.zaraz._f(l); f.zaraz.init = () => { var m = g.getElementsByTagName(i)[0], n = g.createElement(i), o = g.getElementsByTagName("title")[0]; o && (f[h].t = g.getElementsByTagName("title")[0].text); f[h].x = Math.random(); f[h].w = f.screen.width; f[h].h = f.screen.height; f[h].j = f.innerHeight; f[h].e = f.innerWidth; f[h].l = f.location.href; f[h].r = g.referrer; f[h].k = f.screen.colorDepth; f[h].n = g.characterSet; f[h].o = (new Date).getTimezoneOffset(); if (f.dataLayer) for (const s of Object.entries(Object.entries(dataLayer).reduce(((t, u) => ({ ...t[1], ...u[1] }))))) zaraz.set(s[0], s[1], { scope: "page" }); f[h].q = []; for (; f.zaraz.q.length;) { const v = f.zaraz.q.shift(); f[h].q.push(v) } n.defer = !0; for (const w of [localStorage, sessionStorage]) Object.keys(w || {}).filter((y => y.startsWith("_zaraz_"))).forEach((x => { try { f[h]["z_" + x.slice(7)] = JSON.parse(w.getItem(x)) } catch { f[h]["z_" + x.slice(7)] = w.getItem(x) } })); n.referrerPolicy = "origin"; n.src = "../../cdn-cgi/zaraz/sd0d9.js?z=" + btoa(encodeURIComponent(JSON.stringify(f[h]))); m.parentNode.insertBefore(n, m) };["complete", "interactive"].includes(g.readyState) ? zaraz.init() : f.addEventListener("DOMContentLoaded", zaraz.init) }(w, d, "zarazData", "script"); })(window, document);</script>
</head>


<body>

  <div id="preloader-active">
    <div class="preloader d-flex align-items-center justify-content-center">
      <div class="preloader-inner position-relative">
        <div class="preloader-circle"></div>
        <div class="preloader-img pere-text">
        </div>
      </div>
    </div>
  </div>

  <header>
    <div class="header-area">
      <div class="header-mid header-sticky">
        <div class="container">
          <div class="menu-wrapper">



            <div class="main-menu d-none d-lg-block">
              <nav>
                <ul id="navigation">

                  <% categorie.forEach((x)=>{ %>
                    <li><a href="categories?q=<%=x.category%>"><%= x.category %></a></li>
                    <%})%>
                    <% if(logginChecker==true){%>
                      <li><a href="/logout">Logout</a></li>
                      <%}else{%>
                          <li><a href="/loginPage">Login</a></li>
                          <%}%>
                </ul>
              </nav>
            </div>

            <div class="header-right">
              <ul>
                <li>
                  <div class="nav-search search-switch hearer_icon">
                    <a id="search_1" href="javascript:void(0)">
                      <span class="flaticon-search"></span>
                    </a>
                  </div>
                </li>
                <li> <a href="accountView"><span class="flaticon-user"></span></a></li>
                <li class="cart" data-count="<%=cartCount%>"><a href="cart"><span class="flaticon-shopping-cart"></span></a>
                </ul>
            </div>
          </div>

          <div class="search_input" id="search_input_box">
            <form class="search-inner d-flex justify-content-between ">
              <input type="text" class="form-control" id="search_input" placeholder="Search Here">
              <button type="submit" class="btn"></button>
              <span class="ti-close" id="close_search" title="Close Search"></span>
            </form>
          </div>

          <div class="col-12">
            <div class="mobile_menu d-block d-lg-none"></div>
          </div>
        </div>
      </div>

    </div>
  </header>
  <main>

    <div class="hero-area section-bg2">
      <div class="container">
        <div class="row">
          <div class="col-xl-12">
            <div class="slider-area">
              <div class="slider-height2 slider-bg4 d-flex align-items-center justify-content-center">
                <div class="hero-caption hero-caption2">
                  <h2>Checkout</h2>
                  <nav aria-label="breadcrumb">
                    <ol class="breadcrumb justify-content-center">
                      <li class="breadcrumb-item"><a href="index-2">Home</a></li>
                      <li class="breadcrumb-item"><a href="#">Checkout</a></li>
                    </ol>
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <section class="checkout_area">
      <div class="container">
                  <p>
            If you have shopped with us before, please enter your details in the
            boxes below. If you are a new customer, please proceed to the
            Billing & Shipping section.
          </p>

          <div class="cupon_area">
            <div id="couponErr" style="color: red;"></div>
            <div id="couponValidate" style="color: green;"></div>
  <form  onsubmit="validator(event)" method="post">
<input type="text" name="coupenCode" id="coupon" placeholder="Enter coupon code" />
<button type="submit" class="btn">Apply Coupon</button>
</form>
</div>
          <div class="billing_details">
              <div class="row">
                <div class="col-lg-8">
                  <form class="row contact_form" action="adress" method="post" >
            
                  <h3>Billing Details</h3>

                  <div class="col-md-6 form-group p_star">
                    <input placeholder="First name" type="text" class="form-control" id="first" name="firstName"  required/>
                  </div>
                  <div class="col-md-6 form-group p_star">
                    <input placeholder="Last name" type="text" class="form-control"  id="last" name="lastName" required/>
                    
                  </div>
                  <div class="col-md-6 form-group p_star">
                    <input placeholder="Phone number" type="number" class="form-control" id="number" name="phoneNumber"required />
                  
                  </div>
                  <div class="col-md-12 form-group p_star">
                    <select required class="country_select" name="contry">
                      <option value="country">India</option>
                      <option value="country">USA</option>
                      <option value="country">QATAR</option>
                    </select>
                  </div>
                  <div class="col-md-12 form-group p_star">
                    <input type="text" placeholder="Home adress" class="form-control" id="add1" name="homeAdress" required/>
                    
                  </div>
                  <div class="col-md-12 form-group p_star">
                    <input type="text" class="form-control"placeholder="Town/City"  id="city" name="townName" required/>
                    
                  </div>

                  <div class="col-md-12 form-group">
                    <input type="number"required class="form-control" id="zip" name="pincode" placeholder="Postcode/ZIP" />
                  </div>
                  <div class="col-md-12 form-group">
                  </div>
                  <div class="col-md-12 form-group">
                  </div>
                    <button class="btn w-100" type="submit"> New adress</button>
                  </form>
                </div>
                
                
        <div class="col-lg-4">
          <span class="btn w-100">
            <strong>Wallet</strong>
            <span class="wallet-balance"> Balance:₹<%=userCart.wallet%></span>
          </span>
          
          <div class="order_box">
          <form onsubmit="deleveryBtn(event)" id="formdetails">
            <div class="">
            <% userCart.Adress.forEach((x)=> { %>
              <p>
                <%= x.phoneNumber %>
              </p>
              <p>
                <%= x.country %>
              </p>
              <p>
                <%= x.pincode %>
              </p>
              <p>
                <%= x.homeAdress %>
              </p>
              <p>
                <%= x.townName %>
              </p>
              <p>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="address" id="address<%= x._id %>"
                  value="<%= x._id %>" required>
                <label class="form-check-label" for="address<%= x._id %>">
                  Select Address
                </label>
              </div>
              </p>
              <p>
                <a href="deleteAddress?q=<%=x._id %>" class="btn btn-danger">Delete Address</a>
              </p>

              <% }) %>
          </div>
        
              <h2>Your Order</h2>
              <ul class="list">
                <% userCart.cart.forEach((x)=>{%>
                  <li>
                    <a href="#"style="display:flex">
                      <span class="first" style="padding: 0px 2px;">
                        <%=x.product.productName%>
                        </span>
                      
                        <span class="middle" style="padding: 0px 5px;">
                          <%=x.quantity%>
                        </span>
                        <span class="last">₹<%=x.product.price*x.quantity%></span>
                    </a>
                  </li>
                  <%})%>
                    <ul class="list list_2">
                      <li>
                        <a href="#">Total  ₹<span id="totelprice"> <%=subTotal %></span></a>
                      </li>
                      <li>
                        <a href="#">Discount Applied : <span id="discount-applied">₹ 0</span>
                        </a>
                      </li> 
                      <li>
                        <a href="#">Sub Total<span id="sub-total-amount">₹ <%=subTotal %></span>
                        </a>
                      </li>
                    </ul>
              </ul>
              <div class="payment_item active">
    
                <input type="radio" id="payment" name="paymentOption" value="COD" />
                <label for="payment">COD </label>

                <input type="radio" id="payment" name="paymentOption" value="ONLINE" />
                <label for="payment">ONLINE </label>
                <% if(userCart.wallet==0){%>
                  <input type="checkbox"  hidden name="Wallet" value="useWallet" />
                <label  hidden for="payment">Wallet </label>
               <% }else{%>
                <input type="checkbox"  name="Wallet" value="useWallet" />
                <label for="payment">Wallet </label>
                <%}%>

              </div>
          
            
              <button class="btn w-100" type="submit"> Proceed to delivery</button>
            </form>
       </div>   
       </div>
       </div>
       </div>     
      </div>
    </section>
  </main>
  <footer>
    <div class="footer-wrapper gray-bg">
      <div class="footer-area footer-padding">

        <section class="subscribe-area">
          <div class="container">
            <div class="row justify-content-between subscribe-padding">
              <div class="col-xxl-3 col-xl-3 col-lg-4">
                <div class="subscribe-caption">
                  <h3>Subscribe Newsletter</h3>
                  <p>Subscribe newsletter to get 5% on all products.</p>
                </div>
              </div>
              <div class="col-xxl-5 col-xl-6 col-lg-7 col-md-9">
                <div class="subscribe-caption">
                  <form action="#">
                    <input type="text" placeholder="Enter your email">
                    <button class="subscribe-btn">Subscribe</button>
                  </form>
                </div>
              </div>
              <div class="col-xxl-2 col-xl-2 col-lg-4">

                <div class="footer-social">
                  <a href="https://bit.ly/sai4ull"><i class="fab fa-facebook"></i></a>
                  <a href="#"><i class="fab fa-instagram"></i></a>
                  <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
              </div>
            </div>
          </div>
        </section>

        <div class="container">
          <div class="row justify-content-between">
            <div class="col-xl-3 col-lg-3 col-md-6 col-sm-8">
              <div class="single-footer-caption mb-50">
                <div class="single-footer-caption mb-20">


                </div>
              </div>
            </div>
            <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
              <div class="single-footer-caption mb-50">
                <div class="footer-tittle">
                  <h4>Shop Men</h4>
                  <ul>
                    <li><a href="#">Clothing Fashion</a></li>
                    <li><a href="#">Winter</a></li>
                    <li><a href="#">Summer</a></li>
                    <li><a href="#">Formal</a></li>
                    <li><a href="#">Casual</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
              <div class="single-footer-caption mb-50">
                <div class="footer-tittle">
                  <h4>Shop Women</h4>
                  <ul>
                    <li><a href="#">Clothing Fashion</a></li>
                    <li><a href="#">Winter</a></li>
                    <li><a href="#">Summer</a></li>
                    <li><a href="#">Formal</a></li>
                    <li><a href="#">Casual</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
              <div class="single-footer-caption mb-50">
                <div class="footer-tittle">
                  <h4>Baby Collection</h4>
                  <ul>
                    <li><a href="#">Clothing Fashion</a></li>
                    <li><a href="#">Winter</a></li>
                    <li><a href="#">Summer</a></li>
                    <li><a href="#">Formal</a></li>
                    <li><a href="#">Casual</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
              <div class="single-footer-caption mb-50">
                <div class="footer-tittle">
                  <h4>Quick Links</h4>
                  <ul>
                    <li><a href="#">Track Your Order</a></li>
                    <li><a href="#">Support</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Carrier</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">Contact Us</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom-area">
        <div class="container">
          <div class="footer-border">
            <div class="row">
              <div class="col-xl-12 ">

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div id="back-top">
    <a class="wrapper" title="Go to Top" href="#">
      <div class="arrows-container">
        <div class="arrow arrow-one">
        </div>
        <div class="arrow arrow-two">
        </div>
      </div>
    </a>
  </div>

  <style>
 .wallet-balance {
  display: block;
  margin-top: 7px;
  padding-top: 8px;
  color: #ffffff;
  font-size: 14px;
}


  </style>

  <script src="assets/js/vendor/modernizr-3.5.0.min.js"></script>
  <script src="assets/js/vendor/jquery-1.12.4.min.js"></script>
  <script src="assets/js/popper.min.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>

  <script src="assets/js/owl.carousel.min.js"></script>
  <script src="assets/js/slick.min.js"></script>
  <script src="assets/js/jquery.slicknav.min.js"></script>

  <script src="assets/js/wow.min.js"></script>
  <script src="assets/js/jquery.magnific-popup.js"></script>
  <script src="assets/js/jquery.nice-select.min.js"></script>
  <script src="assets/js/jquery.counterup.min.js"></script>
  <script src="assets/js/waypoints.min.js"></script>
  <script src="assets/js/price_rangs.js"></script>

  <script src="assets/js/contact.js"></script>
  <script src="assets/js/jquery.form.js"></script>
  <script src="assets/js/jquery.validate.min.js"></script>
  <script src="assets/js/mail-script.js"></script>
  <script src="assets/js/jquery.ajaxchimp.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
    integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
    crossorigin="anonymous"></script>

  <script src="assets/js/plugins.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="assets/js/main.js"></script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23581568-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-23581568-13');
    async function deleveryBtn(event) {
      event.preventDefault()
      let orderform = document.querySelector('#formdetails')
      let detail = new FormData(orderform)

      let Adress = detail.get('address')
      let paymentOption = detail.get('paymentOption')
      let wallet  = detail.get('Wallet')
      let coupenid = document.getElementById('coupon').value
       

      const response = await fetch(`/order?Adress=${Adress}&paymentOption=${paymentOption}&wallet=${wallet}&coupenid=${coupenid}`, { method: "POST" })
      const result = await response.json()
      if(result.allAmountWallet){
        const clicked=await Swal.fire({
          icon: 'success',
          title: 'order placed',
          text: `click here for`,
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: `See order`,})
          
          if(clicked.isConfirmed){
             window.location.href='payementVerify?q=paid'
          }
          if(clicked.isDismissed){
            window.location.href='payementVerify?q=paid'
          }
      }
      if(result.methode=='COD'){
    try{
    
      const clicked=await Swal.fire({
          icon: 'success',
          title: 'order placed',
          text: `click here for`,
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: `See order`,})
          
          if(clicked.isConfirmed){
             window.location.href='payementVerify?q=Cod'
          }
          if(clicked.isDismissed){
            window.location.href='payementVerify?q=Cod'
          }
     }
    catch(err){
      console.log(err)
    }
    
   }
      if (result.methode == 'online') {
      
       razorpay(result.order)
       
        

      }
      if(result.method=="Adress_is_null"){
        const click=await Swal.fire({
                     icon: 'error',
                     title: 'failed',
                     text: `Adress not added`,
                     timer: 2000,
                     showConfirmButton: false
                     // text: "your order placed please continue shoping"
                   })
      }
    
      function razorpay(order) {
      
        var options = {
          "key": "rzp_test_8emA6zzli6nGP1", // Enter the Key ID generated from the Dashboard
          "amount": order.amount*100, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
          "currency": "INR",
          "name": "on-step",
          "description": "Test Transaction",
          "image": "https://example.com/your_logo",
          "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
          "handler": function (response){
            
            verifyPayment(response,order);
        },
          "prefill": {
            "name": "Shibiludheen",
            "email": "thykkadenshibiludheen@gmail.com",
            "contact": "8848441715"
          },
          "notes": {
            "address": "Razorpay Corporate Office"
          },
          "theme": {
            "color": "#3399cc"
          }
        };
        var rzp1 = new Razorpay(options);
        rzp1.on('payment.failed', function (response) {
          alert(response.error.code);
          alert(response.error.description);
          alert(response.error.source);
          alert(response.error.step);
          alert(response.error.reason);
          alert(response.error.metadata.order_id);
          alert(response.error.metadata.payment_id);
          failedPayement()
        });

        rzp1.open();



      }
      async function failedPayement() {
        const res=await Swal.fire({
                  icon: 'error',
                  title: 'failed',
                  text: "payment failed"
                })
        
      }
      async function verifyPayment(response,order){
        console.log(order)
      const clicked=await Swal.fire({
          icon: 'success',
          title: 'order placed',
          text: `click here for`,
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: `See order`,})
          
          if(clicked.isConfirmed){
             window.location.href='payementVerify?q=paid'
          }
          if(clicked.isDismissed){
            window.location.href='payementVerify?q=paid'
          }
    
    
      }



    }
  </script>
  <script>
    async function validator(event){
   
      event.preventDefault()
      const couponId =document.getElementById('coupon').value
     
      let res = await fetch(`applyCoupen?id=${couponId}`,{method:'post'})
 

      let data = await res.json()
     
      if(data.err){
        document.getElementById('couponErr').innerHTML=data.err
        const res=await Swal.fire({
                  icon: 'error',
                  title: data.err,
                })

      }
      if(data.validated){
        
        let totel = document.getElementById('totelprice').innerHTML
        console.log(totel)
        
        let old = parseFloat(totel)
        let discount = parseFloat(old)*parseFloat(data.discount/100)
        let changed
        if(discount<parseFloat(data.maxAmount)){
          changed = old-discount}
          else{
            changed = old-(parseFloat(data.maxAmount))
          }
          console.log(changed)
          document.getElementById('discount-applied').innerHTML = `₹ ${parseInt(discount)}`
          document.getElementById('sub-total-amount').innerHTML = `₹  ${totel - discount }`
          // document.getElementById('totelprice').innerHTML = `${totel}- (discounted price =  ${parseInt(discount)})= ${totel - discount }`
          document.getElementById('couponValidate').innerHTML='coupon applied'
          const click=await Swal.fire({
                     icon: 'success',
                     title: 'coupon applied',
                     timer: 2000,
                     showConfirmButton: false
                     // text: "your order placed please continue shoping"
                   })

          }
        }
      

    
    </script>
    <script>
      if ( window.history.replaceState ) {
          window.history.replaceState( null, null, window.location.href);
      }
  </script>
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vaafb692b2aea4879b33c060e79fe94621666317369993"
    integrity="sha512-0ahDYl866UMhKuYcW078ScMalXqtFJggm7TmlUtp0UlD4eQk0Ixfnm5ykXKvGJNFjLMoortdseTfsRT8oCfgGA=="
    data-cf-beacon='{"rayId":"78ff30f38f9485c5","token":"cd0b4b3a733644fc843ef0b185f98241","version":"2022.11.3","si":100}'
    crossorigin="anonymous"></script>
</body>

</html>